(function(){(function(){const m=document.createElement("style");m.textContent=`.divee-widget{all:initial;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif!important;width:100%!important;max-width:800px!important;margin:40px auto!important;box-shadow:0 2px 8px #0000001a!important;border-radius:12px!important;overflow:hidden!important;background:#fff!important;border:1px solid #e5e7eb!important;display:block!important;box-sizing:border-box!important}.divee-widget-floating{position:fixed!important;z-index:999999!important;margin:0!important;max-width:400px!important;width:400px!important}.divee-widget-floating[data-state=collapsed]{width:auto!important;max-width:none!important;border-radius:50px!important;box-shadow:0 4px 20px #00000026!important}.divee-widget-floating[data-state=expanded]{width:400px!important;height:auto!important;max-height:90vh!important;border-radius:16px!important;box-shadow:0 8px 32px #0003!important}.divee-widget-floating .divee-expanded{max-height:85vh!important;height:auto!important}.divee-widget-floating[data-floating-position=bottom-right]{bottom:24px!important;right:24px!important}.divee-widget-floating[data-floating-position=bottom-left]{bottom:24px!important;left:24px!important}.divee-widget-floating .divee-collapsed{padding:12px 20px!important;margin:0!important}.divee-widget-floating .divee-search-container-collapsed{margin-bottom:0!important;min-width:280px!important}.divee-widget-floating .divee-powered-by-collapsed{display:none!important}.divee-widget *{box-sizing:border-box!important}.divee-widget input,.divee-widget textarea,.divee-widget button{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif!important}.divee-widget[dir=rtl]{direction:rtl}.divee-widget[dir=rtl] .divee-icons,.divee-widget[dir=rtl] .divee-input-container,.divee-widget[dir=rtl] .divee-input-footer{flex-direction:row-reverse}.divee-widget[dir=rtl] .divee-send{order:-1}.divee-widget[dir=rtl] .divee-send svg,.divee-widget[dir=rtl] .divee-send-icon-collapsed{transform:scaleX(-1)}.divee-widget[dir=rtl] .divee-input{order:0}.divee-widget[dir=rtl] .divee-message-user{align-self:flex-start;align-items:flex-start}.divee-widget[dir=rtl] .divee-message-ai{align-self:flex-end;align-items:flex-start;flex-direction:row-reverse}.divee-widget[dir=rtl] .divee-message-user .divee-message-content{border-bottom-left-radius:4px;border-bottom-right-radius:16px}.divee-widget[dir=rtl] .divee-message-ai .divee-message-content{border-bottom-right-radius:4px;border-bottom-left-radius:16px}.divee-widget[dir=rtl] .divee-warning{text-align:right}.divee-widget[dir=rtl] .divee-counter{text-align:left}.divee-widget[dir=rtl] .divee-cursor{margin-right:2px;margin-left:0}.divee-collapsed{background:#fff;padding:24px;cursor:pointer;transition:all .3s ease-in-out;opacity:1}.divee-collapsed:hover{background:#fafafa}.divee-search-container-collapsed{display:flex;align-items:center;gap:12px;background:linear-gradient(#fff,#fff) padding-box,linear-gradient(135deg,#68e5fd,#a389e0) border-box;border:2px solid transparent;border-radius:40px;padding:12px 16px;margin-bottom:16px;transition:all .3s;box-shadow:0 2px 6px #68e5fd14,0 1px 2px #a389e00d}.divee-search-container-collapsed:hover{background:linear-gradient(#fff,#fff) padding-box,linear-gradient(135deg,#68e5fd,#fd3c4f) border-box;border:2px solid transparent;box-shadow:0 4px 12px #68e5fd26,0 2px 4px #a389e014;transform:translateY(-1px)}.divee-icon-ai-collapsed,.divee-icon-site-collapsed{flex-shrink:0}.divee-icon-ai-collapsed{width:24px;height:24px;color:#a389e0;transition:all .3s}.divee-search-container-collapsed:hover .divee-icon-ai-collapsed{filter:drop-shadow(0 0 4px rgba(163,137,224,.3));transform:rotate(5deg) scale(1.1)}.divee-icon-site-collapsed{width:24px;height:24px;border-radius:50%;object-fit:cover;transition:all .3s}.divee-search-container-collapsed:hover .divee-icon-site-collapsed{border-color:#fd3c4f;box-shadow:0 2px 6px #fd3c4f26;transform:scale(1.1)}.divee-widget .divee-search-input-collapsed{flex:1!important;border:none!important;background:transparent!important;outline:none!important;font-size:18px!important;color:#1f2937!important;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif!important;overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;min-width:0!important;padding:0!important;margin:0!important;height:auto!important;line-height:1.5!important;box-shadow:none!important;appearance:none!important;-webkit-appearance:none!important;-moz-appearance:none!important;border-radius:0!important}.divee-widget .divee-search-input-collapsed::placeholder{color:#6b7280!important}@keyframes typewriter{0%{width:0}to{width:100%}}@keyframes blink{50%{border-color:transparent}}.divee-search-input-collapsed.typewriter-active{border-right:2px solid #A389E0;animation:blink .7s step-end infinite;width:100%;overflow:hidden;white-space:nowrap}.divee-send-icon-collapsed{width:22px;height:22px;color:#4b5563;flex-shrink:0;transition:all .3s}.divee-search-container-collapsed:hover .divee-send-icon-collapsed{filter:drop-shadow(0 0 4px rgba(75,85,99,.25));transform:translate(2px) scale(1.15)}.divee-powered-by-collapsed{padding:0 24px 6px;text-align:left;direction:ltr}.divee-header{display:flex;flex-direction:column;gap:6px;margin-bottom:12px;padding:20px 24px 12px;background:linear-gradient(#fff,#fff) padding-box,linear-gradient(135deg,#68e5fd,#a389e0) border-box;border-bottom:2px solid transparent;background-clip:padding-box,border-box;background-origin:padding-box,border-box}.divee-header-top{display:flex;align-items:center;gap:12px}.divee-powered-by-wrapper{padding:0 0 0 14px;margin-top:3px;text-align:left;direction:ltr}.divee-powered-by{font-size:11px;color:#9ca3af;text-decoration:none;padding:0 4px;display:inline-block}.divee-powered-by:hover{color:#6b7280;text-decoration:underline}.divee-icons{display:flex;align-items:center;gap:10px}.divee-icon-ai,.divee-icon-site{display:flex;align-items:center;justify-content:center;flex-shrink:0}.divee-icon-ai{width:32px;height:32px;color:#a389e0}.divee-icon-site{width:32px;height:32px;border-radius:50%;object-fit:cover}.divee-title{font-weight:600;font-size:16px;color:#1f2937;flex:1}.divee-close{background:none;border:none;font-size:20px;color:#6b7280;cursor:pointer;padding:4px 8px;line-height:1;border-radius:4px;transition:background .2s}.divee-close:hover{background:#f3f4f6}.divee-ad-slot{margin:12px 0;min-height:100px;display:flex;align-items:center;justify-content:center}.divee-ad-slot-expanded{margin-top:5px;display:flex;justify-content:center;min-height:0}.divee-ad-slot-expanded:empty,.divee-ad-slot-expanded:has(>div[style*="display: none"]),.divee-ad-slot-expanded:has(>div:empty){display:none!important;height:0!important;margin:0!important;padding:0!important}.divee-ad-desktop{display:block}.divee-ad-mobile{display:none}.divee-expanded{background:#fff;display:flex;flex-direction:column;max-height:600px;overflow:hidden;transition:opacity .3s ease-in-out,transform .3s ease-in-out;opacity:1;transform:translateY(0)}.divee-widget[data-state=collapsed] .divee-expanded{display:none!important}.divee-widget[data-state=expanded] .divee-expanded{display:flex!important}.divee-widget[data-state=expanded] .divee-collapsed{display:none!important}.divee-content{flex:1;min-height:0;overflow:visible;padding:14px;display:flex;flex-direction:column;gap:16px}.divee-suggestions-input{position:absolute;bottom:100%;left:0;right:0;margin-bottom:12px;background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 4px 20px #00000026;z-index:100;overflow:hidden;transform-origin:bottom center;animation:divee-slide-up-fade .3s ease-out}.divee-suggestions-input:not(.is-open){display:none!important}.divee-suggestions-list{display:flex;flex-direction:column;padding:8px;max-height:220px;overflow-y:auto}.divee-suggestion{background:#fff;border:1px solid transparent;padding:10px 14px;border-radius:8px;text-align:left;font-size:13px;color:#374151;cursor:pointer;transition:all .2s;display:block;width:100%;animation:none;opacity:1}.divee-suggestion:hover{background:#f3f4f6;color:#111827;border-color:#e5e7eb}.divee-widget[dir=rtl] .divee-suggestion{text-align:right;direction:rtl}@keyframes divee-slide-up-fade{0%{opacity:0;transform:translateY(10px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}.divee-loading{padding:12px;text-align:center;color:#6b7280;font-size:14px}.divee-shimmer-line{height:14px;background:linear-gradient(90deg,#f3f4f6,#e5e7eb,#f3f4f6);background-size:200% 100%;border-radius:4px;animation:divee-shimmer 1.5s ease-in-out infinite;width:85%}.divee-loading-item{pointer-events:none;cursor:default;margin-bottom:4px}.divee-loading-item:nth-child(2) .divee-shimmer-line{width:92%}.divee-loading-item:nth-child(3) .divee-shimmer-line{width:78%}.divee-shimmer-line:last-child{margin-bottom:0}@keyframes divee-shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}.divee-error{padding:12px;text-align:center;color:#ef4444;font-size:14px}.divee-chat{height:240px;overflow-y:scroll!important;overflow-x:hidden;scroll-behavior:smooth;margin-bottom:16px;border:1px solid #e5e7eb;border-radius:12px;padding:12px;display:flex;flex-direction:column}.divee-messages{display:flex;flex-direction:column;gap:12px;flex:1}.divee-empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#6b7280;text-align:center;padding:20px;gap:12px;animation:divee-fade-in .3s ease;margin:auto}.divee-empty-icon{width:48px;height:48px;margin-bottom:4px;display:flex;align-items:center;justify-content:center;background:#f3f4f6;border-radius:50%;color:#a389e0}.divee-empty-icon img{width:100%;height:100%;border-radius:50%;object-fit:cover}.divee-empty-text{font-size:14px;line-height:1.5;max-width:260px;color:#6b7280}.divee-message{display:flex;flex-direction:column;gap:4px;animation:divee-fade-in .2s ease;max-width:85%}.divee-message-user{align-self:flex-end;align-items:flex-end}.divee-message-ai{align-self:flex-start;flex-direction:row;align-items:flex-start;gap:8px}.divee-message-label{font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.5px;padding:0 8px;display:flex;align-items:center;gap:6px;flex-shrink:0}.divee-message-ai .divee-message-label{padding:0;margin-top:0}.divee-message-icon{width:28px;height:28px;border-radius:999px;object-fit:cover;border:1px solid rgba(148,163,184,.4)}.divee-message-content{padding:12px 16px;border-radius:16px;font-size:14px;line-height:1.5;white-space:pre-wrap;word-wrap:break-word;box-shadow:0 1px 2px #0000000d}.divee-message-user .divee-message-content{background:linear-gradient(135deg,#68e5fd,#a389e0);color:#fff;border-bottom-right-radius:4px}.divee-message-ai .divee-message-content{background:#f3f4f6;color:#1f2937;border-bottom-left-radius:4px;border:1px solid #e5e7eb}.divee-cursor{color:#68e5fd;flex-wrap:wrap;-blink 1s infinite;margin-left:2px}.divee-input-container{display:flex;align-items:flex-start;padding:10px 0;background:#fff;position:relative;flex-wrap:wrap;gap:10px}.divee-input-footer{display:flex;justify-content:space-between;align-items:center;width:100%;margin-top:0}.divee-warning{font-size:11px;color:#9ca3af;text-align:left}.divee-counter{font-size:11px;color:#9ca3af;text-align:right}.divee-widget .divee-input{flex:1!important;background:linear-gradient(#fff,#fff) padding-box,linear-gradient(135deg,#68e5fd,#a389e0) border-box!important;border:2px solid transparent!important;border-radius:40px!important;padding:10px 22px!important;font-size:14px!important;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif!important;resize:none!important;max-height:100px!important;min-height:auto!important;outline:none!important;transition:all .3s!important;overflow:hidden!important;height:auto!important;margin:0!important;box-shadow:none!important;appearance:none!important;-webkit-appearance:none!important;-moz-appearance:none!important;line-height:1.5!important}.divee-widget .divee-input:focus{background:linear-gradient(#fff,#fff) padding-box,linear-gradient(135deg,#68e5fd,#fd3c4f) border-box!important;border:2px solid transparent!important;box-shadow:0 4px 12px #68e5fd26,0 2px 4px #a389e014!important}.divee-widget .divee-input::placeholder{color:#9ca3af!important}.divee-send{background:linear-gradient(135deg,#68e5fd,#a389e0);color:#fff;border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;flex-shrink:0;margin-top:4px;box-shadow:0 2px 6px #68e5fd4d}.divee-send svg{width:20px;height:20px;fill:#fff}.divee-send:hover{transform:scale(1.1);box-shadow:0 4px 12px #68e5fd66}.divee-send:disabled{background:#d1d5db;cursor:not-allowed}@keyframes divee-fade-in{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes divee-slide-up{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes divee-blink{0%,50%{opacity:1}51%,to{opacity:0}}.divee-content::-webkit-scrollbar,.divee-chat::-webkit-scrollbar{width:10px}.divee-content::-webkit-scrollbar-track,.divee-chat::-webkit-scrollbar-track{background:#f3f4f6;border-radius:8px}.divee-content::-webkit-scrollbar-thumb,.divee-chat::-webkit-scrollbar-thumb{background:#a389e0;border-radius:8px}.divee-content::-webkit-scrollbar-thumb:hover,.divee-chat::-webkit-scrollbar-thumb:hover{background:#8b6bc9}@media(max-width:768px){.divee-expanded{max-height:75vh}.divee-icon-ai-collapsed{display:none}.divee-search-input-collapsed{font-size:15px}.divee-ad-desktop{display:none!important}.divee-ad-mobile{display:block!important}.divee-widget-floating[data-state=collapsed]{width:56px!important;height:56px!important;border-radius:50%!important}.divee-widget-floating .divee-collapsed{padding:0!important;display:flex!important;align-items:center!important;justify-content:center!important;width:56px!important;height:56px!important;margin:0!important}.divee-widget-floating .divee-search-container-collapsed{min-width:0!important;width:56px!important;height:56px!important;padding:0!important;border-radius:50%!important;display:flex!important;align-items:center!important;justify-content:center!important;margin:0!important;gap:0!important}.divee-widget-floating .divee-icon-ai-collapsed{display:block!important;width:28px!important;height:28px!important}.divee-widget-floating .divee-icon-site-collapsed,.divee-widget-floating .divee-search-input-collapsed,.divee-widget-floating .divee-send-icon-collapsed{display:none!important}.divee-widget-floating[data-state=expanded]{width:calc(100vw - 16px)!important;max-width:400px!important;height:auto!important;max-height:70vh!important;bottom:8px!important;border-radius:16px!important}.divee-widget-floating[data-floating-position=bottom-right]{right:8px!important}.divee-widget-floating[data-floating-position=bottom-left]{left:8px!important}.divee-widget-floating .divee-expanded{max-height:70vh!important;height:auto!important;border-radius:16px!important}.divee-widget-floating .divee-header{padding:16px 20px 10px!important;margin-bottom:8px!important}.divee-widget-floating .divee-content{padding:10px!important;gap:12px!important}}.divee-widget[dir=rtl] .divee-search-input-collapsed{text-align:right;direction:rtl}.divee-widget[dir=rtl] .divee-send-icon-collapsed{transform:scaleX(-1)}.divee-widget[dir=rtl] .divee-search-container-collapsed:hover .divee-send-icon-collapsed{transform:scaleX(-1) translate(-2px) scale(1.15)}
`,document.head.appendChild(m)})();function C(m){const u=["article",".article-content","[role='main']","main",".post-content",".entry-content",".content"],E=()=>{if(m){const s=document.querySelector(m);if(s)return s}for(const s of u){const d=document.querySelector(s);if(d)return d}return document.body},t=(s,d)=>!!s.closest(d),e=(s,d)=>{const f=s.previousElementSibling?.tagName?.toLowerCase(),v=s.nextElementSibling?.tagName?.toLowerCase();if(f==="figcaption"||v==="figcaption"||d.length<100&&(f==="img"||v==="img"))return!0;const x=!!s.querySelector("i, em"),w=!!s.querySelector("small"),D=(s.getAttribute("style")||"").toLowerCase(),b=(s.className||"").toLowerCase();return(x||w)&&d.length<150||b.includes("caption")||b.includes("credit")||b.includes("source")||D.includes("font-size")&&D.includes("small")},o=(s,d)=>{if(!d)return 0;const f=s.getElementsByTagName("a");if(!f.length)return 0;let v=0;for(const x of f)v+=(x.textContent||"").trim().length;return v/d.length},i=(s,d)=>{const f=d.toLowerCase();if([/\badvertisement\b/,/\bsponsored\b/,/\bpromotion\b/,/\bpartner content\b/,/\baffiliate\b/,/\bcontinue reading below\b/,/\bread more\b/,/\bclick here\b/,/\bsign up for\b/,/\bsubscribe to\b/,/\bnewsletter\b/,/special offer/,/limited time/,/\bdiscount\b/,/\bsale\b.*\bends\b/].some(y=>y.test(f)))return!0;const x=(s.className||"").toLowerCase(),w=(s.id||"").toLowerCase(),D=(s.parentElement?.className||"").toLowerCase();if(["ad","ads","advertisement","sponsor","promoted","promo","banner","commercial","widget","sidebar","related","recommended"].some(y=>x.includes(y)||w.includes(y)||D.includes(y)))return!0;const S=Array.from(s.getElementsByTagName("a"));return S.length===1&&(S[0].textContent||"").trim()===d?!0:S.some(y=>{const k=y.getAttribute("href")||"";return k.includes("utm_")||k.includes("ref=")||k.includes("click=")||k.includes("campaign=")})},a=(()=>{try{if(typeof Readability!="function")return null;const s=document.cloneNode(!0),d=new Readability(s).parse();return d?{title:d.title||document.title||"Untitled",content:d.content||""}:null}catch{return null}})(),c=E(),r=a?.content||c.innerHTML,l=document.createElement("div");l.innerHTML=r;let g=Array.from(l.querySelectorAll("p")).filter(s=>(s.textContent||"").trim().length>0);g.length<3&&(g=Array.from(l.querySelectorAll("span, div")).filter(s=>(s.textContent||"").trim().length>30).filter(s=>!s.querySelector("p")));const p=[],h={empty:0,insideFigure:0,insideAside:0,caption:0,highLinkDensity:0,adContent:0,tooShort:0};for(const s of g){const d=(s.textContent||"").trim();if(!d){h.empty++;continue}if(t(s,"figure")){h.insideFigure++;continue}if(t(s,"aside")){h.insideAside++;continue}if(e(s,d)){h.caption++;continue}if(o(s,d)>.8){h.highLinkDensity++;continue}if(i(s,d)){h.adContent++;continue}if(d.length<20){h.tooShort++;continue}p.push(d)}return p.join(`

`)}function _(){try{if(typeof Readability=="function"){const m=document.cloneNode(!0),u=new Readability(m).parse();if(u&&u.title)return u.title}}catch{}return document.title||"Untitled"}function A(){return window.location.href}(function(){"use strict";class m{constructor(t){this.config={projectId:t.projectId,apiBaseUrl:t.apiBaseUrl||"http://localhost:3000/api/v1",displayMode:"anchored",floatingPosition:"bottom-right",articleClass:null,containerSelector:null},this.state={isExpanded:!1,isStreaming:!1,suggestions:[],messages:[],serverConfig:null},this.elements={},this.contentCache={content:null,title:null,url:null,extracted:!1},this.init()}isDebugMode(){return new URLSearchParams(window.location.search).get("diveeDebug")==="true"}log(...t){this.isDebugMode()}generateUUID(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,o=t=="x"?e:e&3|8;return o.toString(16)})}getAnalyticsIds(){let t=localStorage.getItem("divee_visitor_id");t||(t=this.generateUUID(),localStorage.setItem("divee_visitor_id",t));let e=sessionStorage.getItem("divee_session_id");return e||(e=this.generateUUID(),sessionStorage.setItem("divee_session_id",e)),this.state.visitorId=t,this.state.sessionId=e,{visitorId:t,sessionId:e}}initGoogleAds(){if(this.log("[Divee DEBUG] initGoogleAds called"),this.log("[Divee DEBUG] window.googletag exists:",!!window.googletag),window.googletag&&window.googletag._initialized_by_divee){this.log("[Divee DEBUG] Google Ads already initialized by Divee, skipping");return}this.log("[Divee DEBUG] Initializing Google Ads...");const t=this;window.googletag=window.googletag||{cmd:[]},window.googletag._initialized_by_divee=!0;const e=document.createElement("script");e.async=!0,e.src="https://securepubads.g.doubleclick.net/tag/js/gpt.js",e.crossOrigin="anonymous",e.onload=function(){t.log("[Divee DEBUG] \u2713 Google Ads script loaded successfully"),t.log("[Divee DEBUG] googletag object:",window.googletag)},e.onerror=function(){},document.head.appendChild(e),this.log("[Divee DEBUG] Google Ads script tag added to head"),this.log("[Divee DEBUG] Script element:",e),googletag.cmd.push(function(){t.log("[Divee DEBUG] === Inside googletag.cmd.push callback ==="),t.log("[Divee DEBUG] Defining ad slots...");const o=googletag.defineSlot("/22065771467,227399588/Divee.AI/desktop/Divee.AI_banner",[[650,100],[728,90]],"div-gpt-ad-1768979426842-0");t.log("[Divee DEBUG] Desktop slot result:",o),o&&(o.addService(googletag.pubads()),t.log("[Divee DEBUG] \u2713 Desktop ad slot defined:",o.getSlotElementId()));const i=googletag.defineSlot("/22065771467,227399588/Divee.AI/mobileweb/Divee.AI_cube",[[336,280],[300,250]],"div-gpt-ad-1768979511037-0");t.log("[Divee DEBUG] Mobile slot result:",i),i&&(i.addService(googletag.pubads()),t.log("[Divee DEBUG] \u2713 Mobile ad slot defined:",i.getSlotElementId()));const n=googletag.defineSlot("/22065771467,227399588/Divee.AI/desktop/Divee.AI_banner",[[650,100],[728,90]],"div-gpt-ad-expanded-desktop");t.log("[Divee DEBUG] Expanded desktop slot result:",n),n&&(n.addService(googletag.pubads()),t.log("[Divee DEBUG] \u2713 Expanded desktop ad slot defined:",n.getSlotElementId()));const a=googletag.defineSlot("/22065771467,227399588/Divee.AI/mobileweb/Divee.AI_cube",[[336,280],[300,250]],"div-gpt-ad-expanded-mobile");t.log("[Divee DEBUG] Expanded mobile slot result:",a),a&&(a.addService(googletag.pubads()),t.log("[Divee DEBUG] \u2713 Expanded mobile ad slot defined:",a.getSlotElementId())),googletag.pubads().collapseEmptyDivs(),t.log("[Divee DEBUG] Configured to collapse empty ad divs"),googletag.enableServices(),t.log("[Divee DEBUG] \u2713 Google Ads services enabled"),t.log("[Divee DEBUG] === Finished defining ad slots ===")})}async init(){if(this.log("[Divee] Initializing widget...",this.config),this.getAnalyticsIds(),this.initGoogleAds(),await this.loadServerConfig(),!this.state.serverConfig){this.log("[Divee] Widget disabled due to config load failure");return}this.extractArticleContent(),this.createWidget(),this.attachEventListeners(),this.trackEvent("widget_loaded",{project_id:this.config.projectId,article_id:this.config.articleId,position:this.config.position})}async loadServerConfig(){try{const t=await this.fetchServerConfig({client_id:this.config.projectId,title:this.contentCache.title||this.articleTitle,url:this.contentCache.url||this.articleUrl,article_content:this.contentCache.content||this.articleContent,visitor_id:this.state.visitorId,session_id:this.state.sessionId,referrer:document.referrer,user_agent:navigator.userAgent});this.state.serverConfig=t,this.log("[Divee] Server config loaded:",this.state.serverConfig),t.display_mode&&(this.config.displayMode=t.display_mode,this.log("[Divee] Display mode from config:",t.display_mode)),t.display_position&&(this.config.floatingPosition=t.display_position,this.log("[Divee] Display position from config:",t.display_position)),t.article_class&&(this.config.articleClass=t.article_class,this.log("[Divee] Article class from config:",t.article_class)),t.widget_container_class&&(this.config.containerSelector=t.widget_container_class,this.log("[Divee] Container selector from config:",t.widget_container_class)),t.direction&&this.elements.container?.setAttribute("dir",t.direction),t.language&&this.elements.container?.setAttribute("lang",t.language)}catch{this.state.serverConfig=null}}async fetchServerConfig(t){if(!this.config.apiBaseUrl)throw new Error("Missing apiBaseUrl");const e=await fetch(`${this.config.apiBaseUrl}/config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Config request failed: ${e.status}`);return e.json()}getDefaultConfig(){return{direction:"ltr",language:"en",icon_url:"https://images.icon-icons.com/167/PNG/512/cnn_23166.png",client_name:"Demo Site",client_description:"Article Assistant",highlight_color:["#68E5FD","#A389E0"],show_ad:!0,input_text_placeholders:["Ask anything about this article..."]}}extractArticleContent(){if(this.contentCache.extracted){this.log("[Divee] Using cached content"),this.articleTitle=this.contentCache.title,this.articleContent=this.contentCache.content;return}try{if(typeof _=="function"?this.articleTitle=_():this.articleTitle=document.title||document.querySelector("h1")?.textContent||"Untitled Article",typeof C=="function")this.articleContent=C(this.config.articleClass);else{const t=document.querySelector("article")||document.querySelector('[role="article"]')||document.querySelector("main");this.articleContent=t?t.textContent.trim():document.body.textContent.trim()}typeof A=="function"?this.articleUrl=A():this.articleUrl=window.location.href,this.contentCache={content:this.articleContent,title:this.articleTitle,url:this.articleUrl,extracted:!0},this.log("[Divee] Article extracted and cached:",{title:this.articleTitle,url:this.articleUrl,contentLength:this.articleContent.length})}catch{this.articleTitle=document.title||"Untitled Article",this.articleContent=document.body.textContent.trim(),this.articleUrl=window.location.href}}createWidget(){const t=document.createElement("div");t.className="divee-widget",t.setAttribute("data-state","collapsed"),this.config.displayMode==="floating"&&(t.classList.add("divee-widget-floating"),t.setAttribute("data-floating-position",this.config.floatingPosition));const e=this.state.serverConfig||this.getDefaultConfig();e.direction&&t.setAttribute("dir",e.direction);const o=this.createCollapsedView();t.appendChild(o);const i=this.createExpandedView();i.style.display="none",t.appendChild(i),this.elements.container=t,this.elements.collapsedView=o,this.elements.expandedView=i,this.insertWidget(t)}createCollapsedView(){const t=document.createElement("div");t.className="divee-collapsed";const e=this.state.serverConfig||this.getDefaultConfig(),o=e.show_ad&&this.config.displayMode!=="floating"?"":'style="display: none;"';return this.log("[Divee DEBUG] Creating collapsed view with showAd:",o),this.log("[Divee DEBUG] config.show_ad:",e.show_ad),t.innerHTML=`
                <div class="divee-powered-by-collapsed">
                    <a class="divee-powered-by" href="https://www.divee.ai" target="_blank" rel="noopener noreferrer">powered by divee.ai</a>
                </div>
                <div class="divee-search-container-collapsed">
                    <img class="divee-icon-ai-collapsed" src="https://srv.divee.ai/storage/v1/object/public/public-files/ai.png" alt="AI icon" />
                    <img class="divee-icon-site-collapsed" src="${e.icon_url}" alt="Site icon" />
                    <input type="text" class="divee-search-input-collapsed" placeholder="" readonly />
                    <svg class="divee-send-icon-collapsed" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </div>
                <div class="divee-ad-slot" ${o}>
                    <!-- Desktop Ad -->
                    <div id='div-gpt-ad-1768979426842-0' class='divee-ad-desktop' style='min-width: 650px; min-height: 90px; margin: 0 !important;'></div>
                    <!-- Mobile Ad -->
                    <div id='div-gpt-ad-1768979511037-0' class='divee-ad-mobile' style='min-width: 300px; min-height: 250px;'></div>
        </div>
      `,setTimeout(()=>{const i=t.querySelector(".divee-search-input-collapsed");i&&e.input_text_placeholders&&this.typewriterEffect(i,e.input_text_placeholders)},500),t}typewriterEffect(t,e){if(!t||!e||e.length===0)return;let o=0,i=0;const n=50,a=30,c=2e3,r=500,l=()=>{const p=String(e[o]||"");i<p.length?(t.placeholder=p.substring(0,i+1),i++,setTimeout(l,n+Math.random()*30)):setTimeout(g,c)},g=()=>{const p=String(e[o]||"");i>0?(t.placeholder=p.substring(0,i-1),i--,setTimeout(g,a)):(o=(o+1)%e.length,setTimeout(l,r))};l()}createEmptyState(t){const e=document.createElement("div");e.className="divee-empty-state";const o=t.input_text_placeholders||["Ask anything about this article..."],i=o.length>0?o[0]:"Ask me anything about this article";return e.innerHTML=`
                <div class="divee-empty-icon">
                    <img src="${t.icon_url}" alt="AI" />
                </div>
            `,e}createExpandedView(){const t=document.createElement("div");t.className="divee-expanded";const e=this.state.serverConfig||this.getDefaultConfig(),o=e.input_text_placeholders&&e.input_text_placeholders.length>0?e.input_text_placeholders[0]:"Ask anything about this article...";t.innerHTML=`
                <div class="divee-header">
                    <div class="divee-header-top">
                        <div class="divee-icons">
                            <img class="divee-icon-site-collapsed" src="https://srv.divee.ai/storage/v1/object/public/public-files/ai.png" alt="AI icon" />
                            <img class="divee-icon-site" src="${e.icon_url}" alt="Site icon" />
                        </div>
                        <span class="divee-title">${e.client_name}</span>
                        <button class="divee-close" aria-label="Close">\u2715</button>
                    </div>
                </div>
                <div class="divee-powered-by-wrapper">
                    <a class="divee-powered-by" href="https://www.divee.ai" target="_blank" rel="noopener noreferrer">powered by divee.ai</a>
                </div>
                <div class="divee-content">
                    <div class="divee-chat">
                        <div class="divee-messages"></div>
          </div>
                    <div class="divee-input-container">
                        <div class="divee-suggestions-input" style="display: none;">
                            <div class="divee-suggestions-list"></div>
                        </div>
            <textarea 
                            class="divee-input" 
              placeholder="${o}"
              rows="1"
              maxlength="200"
            ></textarea>
                        <button class="divee-send" aria-label="Send">
              <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
            <div class="divee-input-footer">
                <div class="divee-warning">This is an AI driven tool, results might not always be accurate</div>
                <div class="divee-counter">0/200</div>
            </div>
            
            <!-- Ad Slot in Expanded View -->
            <div class="divee-ad-slot-expanded" style="margin-top: 5px; display: flex; justify-content: center;">
                <!-- Desktop Ad -->
                <div id='div-gpt-ad-expanded-desktop' class='divee-ad-desktop' style='min-width: 650px; min-height: 90px; margin: 0 !important;'></div>
                <!-- Mobile Ad -->
                <div id='div-gpt-ad-expanded-mobile' class='divee-ad-mobile' style='min-width: 300px; min-height: 250px;  margin: 0 !important;'></div>
            </div>
          </div>
        </div>
      `,setTimeout(()=>{const n=t.querySelector(".divee-input");n&&e.input_text_placeholders&&this.typewriterEffect(n,e.input_text_placeholders)},500);const i=t.querySelector(".divee-messages");if(this.state.messages.length===0){const n=this.createEmptyState(e);i.appendChild(n)}return t}insertWidget(t){if(this.log("[Divee] insertWidget called"),this.log("[Divee] Display mode:",this.config.displayMode),this.log("[Divee] Config containerSelector (from server):",this.config.containerSelector),this.config.displayMode==="floating"){this.log("[Divee] Floating mode: appending to body (containerSelector ignored)"),document.body.appendChild(t),this.displayAdsIfNeeded();return}let e=null;this.config.containerSelector?(this.log("[Divee] \u2713 Using containerSelector from server config:",this.config.containerSelector),this.log("[Divee] Attempting to find element with querySelector:",this.config.containerSelector),e=document.querySelector(this.config.containerSelector),e?this.log("[Divee] \u2713 Found custom container element:",{selector:this.config.containerSelector,tagName:e.tagName,className:e.className,id:e.id}):this.log(`[Divee] \u2717 Container selector "${this.config.containerSelector}" not found in DOM, falling back to default behavior`)):this.log("[Divee] No containerSelector from server config, using default auto-detection"),e||(this.log('[Divee] Looking for default containers (article, [role="article"], main)'),e=document.querySelector("article")||document.querySelector('[role="article"]')||document.querySelector("main"),e?this.log("[Divee] \u2713 Found default container:",e.tagName,e.className):this.log("[Divee] \u2717 No default container found, will append to body")),e?(this.log("[Divee] Appending widget to:",e),e.appendChild(t)):(this.log("[Divee] No suitable container found, appending to body as fallback"),document.body.appendChild(t)),this.log("[Divee] Widget inserted successfully"),this.displayAdsIfNeeded()}displayAdsIfNeeded(){const t=this.state.serverConfig||this.getDefaultConfig();if(this.log("[Divee DEBUG] ====== AD DISPLAY CHECK ======"),this.log("[Divee DEBUG] show_ad_config:",t.show_ad),this.log("[Divee DEBUG] googletag_defined:",!!window.googletag),this.log("[Divee DEBUG] googletag object:",window.googletag),this.log("[Divee DEBUG] googletag.cmd length:",window.googletag?.cmd?.length),this.log("[Divee DEBUG] desktop_element exists:",!!document.getElementById("div-gpt-ad-1768979426842-0")),this.log("[Divee DEBUG] mobile_element exists:",!!document.getElementById("div-gpt-ad-1768979511037-0")),this.log("[Divee DEBUG] Will display ads:",t.show_ad&&window.googletag),t.show_ad&&window.googletag){const e=this;e.log("[Divee DEBUG] Setting up 1s timeout for ad display..."),setTimeout(()=>{e.log("[Divee DEBUG] === 1s timeout fired, displaying ads ==="),googletag.cmd.push(function(){e.log("[Divee DEBUG] Inside display cmd callback..."),e.log("[Divee DEBUG] Requesting ad display for slots..."),e.log("[Divee DEBUG] Calling googletag.display for desktop..."),googletag.display("div-gpt-ad-1768979426842-0"),e.log("[Divee DEBUG] \u2713 Display called for div-gpt-ad-1768979426842-0 (desktop)"),e.log("[Divee DEBUG] Calling googletag.display for mobile..."),googletag.display("div-gpt-ad-1768979511037-0"),e.log("[Divee DEBUG] \u2713 Display called for div-gpt-ad-1768979511037-0 (mobile)"),e.log("[Divee DEBUG] Setting up event listeners...");let o=0;googletag.pubads().addEventListener("slotRenderEnded",function(i){const n=i.slot.getSlotElementId(),a=document.getElementById(n);if(e.log("[Divee DEBUG] ====== AD RENDER EVENT ======"),e.log("[Divee DEBUG] Slot:",n),e.log("[Divee DEBUG] isEmpty:",i.isEmpty),e.log("[Divee DEBUG] size:",i.size),e.log("[Divee DEBUG] advertiserId:",i.advertiserId),e.log("[Divee DEBUG] lineItemId:",i.lineItemId),e.log("[Divee DEBUG] creativeId:",i.creativeId),e.log("[Divee DEBUG] element_exists:",!!a),e.log("[Divee DEBUG] adElement:",a),i.isEmpty&&a){if(a.style.display="none",o++,e.log("[Divee DEBUG] Ad slot hidden (empty):",n,`(${o}/2 empty)`),o===2){const c=document.querySelector(".divee-ad-slot");c&&(c.style.display="none",e.log("[Divee DEBUG] Ad slot container hidden (all ads empty)"))}}else i.isEmpty||(e.log("[Divee DEBUG] Ad successfully rendered:",n),e.trackEvent("ad_impression",{ad_unit:n,position:n.includes("expanded")?"expanded":"collapsed",size:i.size?`${i.size[0]}x${i.size[1]}`:"unknown",advertiser_id:i.advertiserId||null,creative_id:i.creativeId||null,line_item_id:i.lineItemId||null}),a&&e.setupAdClickTracking(a,n,i))}),googletag.pubads().addEventListener("slotOnload",function(i){e.log("[Divee DEBUG] Ad slot loaded:",i.slot.getSlotElementId())}),googletag.pubads().addEventListener("slotRequested",function(i){e.log("[Divee DEBUG] Ad slot requested:",i.slot.getSlotElementId())}),googletag.pubads().addEventListener("slotResponseReceived",function(i){e.log("[Divee DEBUG] Ad slot response received:",i.slot.getSlotElementId())})})},1e3)}else this.log("[Divee WARNING] Ads NOT displayed!"),this.log("[Divee WARNING] Reason:",t.show_ad?"googletag not available":"show_ad is false in config"),this.log("[Divee WARNING] config.show_ad:",t.show_ad),this.log("[Divee WARNING] window.googletag:",!!window.googletag)}displayExpandedAds(){if(!(this.state.serverConfig||this.getDefaultConfig()).show_ad||!window.googletag){this.log("[Divee DEBUG] Skipping expanded ads display");return}const e=this;this.log("[Divee DEBUG] Displaying expanded view ads..."),googletag.cmd.push(function(){e.log("[Divee DEBUG] Requesting expanded ad display...");const o=document.getElementById("div-gpt-ad-expanded-desktop"),i=document.getElementById("div-gpt-ad-expanded-mobile");o&&(googletag.display("div-gpt-ad-expanded-desktop"),e.log("[Divee DEBUG] \u2713 Display called for expanded desktop ad")),i&&(googletag.display("div-gpt-ad-expanded-mobile"),e.log("[Divee DEBUG] \u2713 Display called for expanded mobile ad"))})}attachEventListeners(){this.elements.collapsedView.addEventListener("click",()=>this.expand()),this.elements.expandedView.querySelector(".divee-close").addEventListener("click",i=>{i.stopPropagation(),this.collapse()});const e=this.elements.expandedView.querySelector(".divee-input");e.addEventListener("focus",()=>this.onTextAreaFocus()),e.addEventListener("click",()=>this.onTextAreaFocus()),e.addEventListener("input",i=>{this.autoResizeTextarea(i.target),this.updateCharacterCounter(i.target)}),document.addEventListener("click",i=>{const n=this.elements.expandedView.querySelector(".divee-suggestions-input"),a=this.elements.expandedView.querySelector(".divee-input-container");n&&n.classList.contains("is-open")&&!a.contains(i.target)&&n.classList.remove("is-open")}),this.elements.expandedView.querySelector(".divee-send").addEventListener("click",()=>this.sendQuestion()),e.addEventListener("keydown",i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),this.sendQuestion())})}expand(){this.state.isExpanded=!0,this.elements.container.setAttribute("data-state","expanded"),this.elements.expandedView.style.display="block",this.elements.expandedView.style.opacity="0",this.elements.expandedView.style.transform="translateY(10px)",this.elements.collapsedView.style.opacity="0",setTimeout(()=>{this.elements.collapsedView.style.display="none",this.elements.expandedView.style.opacity="1",this.elements.expandedView.style.transform="translateY(0)",this.displayExpandedAds()},150),this.trackEvent("widget_expanded",{trigger:"click"}),setTimeout(()=>{this.elements.expandedView.querySelector(".divee-input").focus()},300)}collapse(){this.state.isExpanded=!1,this.elements.container.setAttribute("data-state","collapsed"),this.elements.expandedView.style.opacity="0",this.elements.expandedView.style.transform="translateY(10px)",setTimeout(()=>{this.elements.expandedView.style.display="none",this.elements.collapsedView.style.display="block",this.elements.collapsedView.style.opacity="0",setTimeout(()=>{this.elements.collapsedView.style.opacity="1"},50)},200),this.trackEvent("widget_collapsed",{time_spent:Date.now(),questions_asked:this.state.messages.filter(t=>t.role==="user").length})}async onTextAreaFocus(){const t=this.elements.expandedView.querySelector(".divee-suggestions-input");if(this.state.suggestions.length>0){t&&!t.classList.contains("is-open")&&(t.style.display="block",t.classList.add("is-open"),this.trackEvent("suggestions_reopened",{count:this.state.suggestions.length}));return}this.trackEvent("textarea_focused",{timestamp:Date.now()});const e=t?.querySelector(".divee-suggestions-list");t&&e&&(t.style.display="block",t.classList.add("is-open"),e.innerHTML=`
        <div class="divee-suggestion divee-loading-item"><div class="divee-shimmer-line"></div></div>
        <div class="divee-suggestion divee-loading-item"><div class="divee-shimmer-line"></div></div>
        <div class="divee-suggestion divee-loading-item"><div class="divee-shimmer-line"></div></div>
      `);try{const o=await this.fetchSuggestions();if(this.state.suggestions=o,!e)return;e.innerHTML="",o.forEach((i,n)=>{const a=typeof i=="string"?i:i.question,c=typeof i=="string"?null:i.id,r=document.createElement("button");r.className="divee-suggestion",r.setAttribute("data-index",n),c&&r.setAttribute("data-id",c),r.textContent=a,r.addEventListener("click",l=>{const g=l.target.textContent,p=l.target.getAttribute("data-id");this.askQuestion(g,"suggestion",p)}),e.appendChild(r)}),this.trackEvent("suggestions_fetched",{article_id:this.config.articleId,suggestions_count:o.length,load_time:0})}catch{e&&(e.innerHTML='<div class="divee-error">Could not load suggestions</div>')}}async fetchSuggestions(){const t={projectId:this.config.projectId,articleId:this.config.articleId,title:this.contentCache.title,url:this.contentCache.url,content:this.contentCache.content,visitor_id:this.state.visitorId,session_id:this.state.sessionId};try{const e=await fetch(`${this.config.apiBaseUrl}/suggestions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Suggestions request failed: ${e.status}`);const o=await e.json();if(Array.isArray(o?.suggestions))return o.suggestions}catch{}return[]}sendQuestion(){const t=this.elements.expandedView.querySelector(".divee-input"),e=t.value.trim();if(!e)return;this.askQuestion(e,"custom",null),t.value="",t.style.height="auto";const o=this.elements.expandedView.querySelector(".divee-counter");o&&(o.textContent="0/200")}async askQuestion(t,e,o){const i=this.elements.expandedView.querySelector(".divee-suggestions-input");i&&i.classList.remove("is-open"),this.addMessage("user",t),this.trackEvent("question_asked",{type:e,question:t,question_id:o}),this.state.isStreaming=!0;const n=this.addMessage("ai","",!0);try{await this.streamResponse(t,n,o)}catch{this.updateMessage(n,"Sorry, I encountered an error. Please try again.")}finally{this.state.isStreaming=!1}}addMessage(t,e,o=!1){const i=this.elements.expandedView.querySelector(".divee-messages"),n=i.querySelector(".divee-empty-state");n&&n.remove();const a=this.elements.expandedView.querySelector(".divee-chat"),c=`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=document.createElement("div");r.className=`divee-message divee-message-${t}`,r.setAttribute("data-message-id",c);const l=document.createElement("div");if(l.className="divee-message-label",t==="user")l.textContent="You";else{const p=this.state.serverConfig||this.getDefaultConfig();l.innerHTML=`<img class="divee-message-icon" src="${p.icon_url}" alt="AI" />`}const g=document.createElement("div");if(g.className="divee-message-content",g.textContent=e,o){const p=document.createElement("span");p.className="divee-cursor",p.textContent="\u258A",g.appendChild(p)}return r.appendChild(l),r.appendChild(g),i.appendChild(r),a.scrollTop=a.scrollHeight,this.state.messages.push({id:c,role:t,content:e}),c}updateMessage(t,e,o=!1){const i=this.elements.expandedView.querySelector(`[data-message-id="${t}"]`);if(!i)return;const n=i.querySelector(".divee-message-content"),a=n.querySelector(".divee-cursor");if(o){const r=document.createTextNode(e);a?n.insertBefore(r,a):n.appendChild(r)}else a&&a.remove(),n.textContent=e;const c=this.elements.expandedView.querySelector(".divee-chat");c.scrollTop=c.scrollHeight}async simulateStreaming(t,e){for(let i=0;i<e.length;i+=4){const n=e.slice(i,i+4);this.updateMessage(t,n,!0),await new Promise(a=>setTimeout(a,15))}}async streamResponse(t,e,o){const i={projectId:this.config.projectId,questionId:o||`q-${Date.now()}`,question:t,title:this.contentCache.title,url:this.contentCache.url,content:this.contentCache.content,visitor_id:this.state.visitorId,session_id:this.state.sessionId},n=await fetch(`${this.config.apiBaseUrl}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!n.ok){if(n.status===403){this.updateMessage(e,"Free form questions are currently not supported.");const g=this.elements.expandedView.querySelector(`[data-message-id="${e}"]`)?.querySelector(".divee-cursor");g&&g.remove();return}throw new Error(`Chat request failed: ${n.status}`)}if((n.headers.get("content-type")||"").includes("application/json")){const l=await n.json();l?.answer&&await this.simulateStreaming(e,l.answer)}else if(n.body){const l=n.body.getReader(),g=new TextDecoder;let p="";for(;;){const{value:h,done:I}=await l.read();if(I)break;p+=g.decode(h,{stream:!0});const s=p.split(`

`);p=s.pop()||"";for(const d of s){const f=d.split(`
`);for(const v of f){const x=v.trim();if(!x.startsWith("data:"))continue;const w=x.replace(/^data:\s*/,"");if(w!=="[DONE]")try{const b=JSON.parse(w)?.choices?.[0]?.delta?.content;b&&this.updateMessage(e,b,!0)}catch{}}}}}const r=this.elements.expandedView.querySelector(`[data-message-id="${e}"]`)?.querySelector(".divee-cursor");r&&r.remove()}autoResizeTextarea(t){t.style.height="auto",t.style.height=Math.min(t.scrollHeight,150)+"px"}updateCharacterCounter(t){const e=this.elements.expandedView.querySelector(".divee-counter");if(e){const o=t.value.length;e.textContent=`${o}/200`}}setupAdClickTracking(t,e,o){const i=this;t.addEventListener("click",function(n){i.log("[Divee DEBUG] Ad clicked:",e),i.trackEvent("ad_click",{ad_unit:e,position:e.includes("expanded")?"expanded":"collapsed",size:o.size?`${o.size[0]}x${o.size[1]}`:"unknown",advertiser_id:o.advertiserId||null,creative_id:o.creativeId||null,line_item_id:o.lineItemId||null,click_x:n.clientX,click_y:n.clientY,timestamp:Date.now()})}),setTimeout(()=>{const n=t.querySelector("iframe");if(n)try{n.addEventListener("load",function(){i.log("[Divee DEBUG] Ad iframe loaded:",e)})}catch{i.log("[Divee DEBUG] Cannot access iframe content (cross-origin)")}},100)}async trackEvent(t,e={}){this.log("[Divee Analytics]",t,e);const o=this.state.visitorId,i=this.state.sessionId,n=this.config.projectId;if(!n||!o||!i)return;const a={project_id:n,visitor_id:o,session_id:i,event_type:t,event_label:e.label||null,event_data:e};try{const c=`${this.config.apiBaseUrl}/analytics`;fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),keepalive:!0}).catch(r=>{})}catch{}}}function u(){const E=document.querySelectorAll("script[data-project-id]"),e=new URLSearchParams(window.location.search).get("diveeDebug")==="true";E.forEach((o,i)=>{const n={projectId:o.getAttribute("data-project-id"),apiBaseUrl:"https://srv.divee.ai/functions/v1"};e&&(o.getAttribute("data-display-mode"),o.getAttribute("data-floating-position"),o.getAttribute("data-article-class"),o.getAttribute("data-container-selector")),new m(n)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u(),window.DiveeWidget=m})()})();
